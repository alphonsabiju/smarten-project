<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UB CSE SMARTen - Editable DNA Selector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        html,body{
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            
        }
        
        /* Left Panel Styles */
        .left-panel {
            width: 40%;
            background-color: #2c3e50;
            color: white;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #3498db;
        }
        
        .welcome-section {
            margin-bottom: 40px;
        }
        
        .welcome-section h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .welcome-section p {
            color: #bdc3c7;
            font-size: 16px;
        }
        
        .villain-selection {
            margin-bottom: 30px;
        }
        
        .villain-selection h2 {
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        .villain-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .villain-option {
            background-color: #34495e;
            border: none;
            border-radius: 10px;
            padding: 10px;
            color: white;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }

        .villain-option img{
            width: 90px;
            height: 90px;
            object-fit: contain;
            border-radius: 8px;
            background-color: white;
            padding: 5px;

        }
        
        .villain-option:hover {
            background-color: #3d566e;
            transform: translateY(-2px);
        }
        
        .villain-option.active {
            background-color: #3498db;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .villain-options{
            display:grid;
            grid-template-columns: repeat(auto-fit,minmax(120px,1fr));
            gap: 12px;

        }
        
        .continue-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: auto;
        }
        
        .continue-btn:hover {
            background-color: #2980b9;
        }
        
        .continue-btn:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
        }
        
        /* Right Panel Styles */
        .right-panel {
            width: 60%;
            padding: 30px;
            display: none;
            flex-direction: column;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .panel-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .selected-villain {
            font-size: 18px;
            color: #7f8c8d;
        }
        
        .test-creation {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .test-name-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .full-dna-section {
            margin-bottom: 25px;
        }
        
        .full-dna-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .full-dna {
            width: 100%;
            height: 80px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            background-color: #f8f9fa;
            overflow-y: auto;
            line-height: 1.4;
        }
        
        .dna-selector {
            margin: 25px 0;
        }
        
        .selector-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .slider-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        .slider {
            width: 100%;
            height: 30px;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .selected-dna-section {
            margin-top: 25px;
        }
        
        .selected-dna {
            width: 100%;
            height: 100px;
            padding: 15px;
            border: 2px solid #3498db;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            background-color: #f0f8ff;
        }
        
        .char-count {
            text-align: right;
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .warning {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reset-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .reset-btn:hover {
            background-color: #c0392b;
        }
        
        .save-btn {
            background-color: #f39c12;
            color: white;
        }
        
        .save-btn:hover {
            background-color: #d35400;
        }
        
        .run-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .run-btn:hover {
            background-color: #27ae60;
        }
        
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 0;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            
            .left-panel, .right-panel {
                width: 100%;
            }
            
            .right-panel {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel - Villain Selection -->
        <div class="left-panel" id="leftPanel">
            <div class="logo">UB CSE SMARTen</div>
            
            <div class="welcome-section">
                <h1>Welcome to SMARTen</h1>
                <p>Select Your Villain and Create a Test</p>
            </div>
            
            <div class="villain-selection">
                <h2>Select Your Villain</h2>
                <p>Choose a virus to proceed.</p>
                
                <div class="villain-options">
                    <button class="villain-option" data-villain="Ebola">
                        <img src="images/Ebola.jpg" alt="Ebola" class="villain-img">
                        Ebola
                    </button>
                    <button class="villain-option" data-villain="Flu">
                        <img src="images/Flu.jpg" alt="Flu" class="villain-img">
                        Flu
                    </button>
                    <button class="villain-option" data-villain="Zika">
                        <img src="images/Zika.jpg" alt="Zika" class="villain-img">
                        Zika
                    </button>
                    <button class="villain-option" data-villain="COVID">
                        <img src="images/COVID.jpg" alt="COVID" class="villain-img">
                        COVID
                    </button>
                    <button class="villain-option" data-villain="AIDS">
                        <img src="images/HIV.jpg" alt="AIDS" class="villain-img">
                        AIDS
                    </button>
                    

                </div>
            </div>
            
            <button class="continue-btn" id="continueBtn" disabled>Continue</button>
        </div>
        
        <!-- Right Panel - Test Creation -->
        <div class="right-panel" id="rightPanel">
            <div class="panel-header">
                <div class="panel-title">UB CSE SMARTen</div>
                <div class="selected-villain" id="selectedVillainText">Selected Villain: None</div>
            </div>
            
            <div class="test-creation">
                <h2>Edit the DNA fragment and name your test.</h2>
                
                <div class="form-group">
                    <label for="testName">Name Your Test</label>
                    <input type="text" id="testName" class="test-name-input" placeholder="Enter test name" value="Ebola Test">
                </div>
                
                <div class="full-dna-section">
                    <div class="full-dna-label">
                        <label>Full DNA Sequence</label>
                        <span id="fullDnaLength">Length: 0 characters</span>
                    </div>
                    <div id="fullDna" class="full-dna"></div>
                </div>
                
                <div class="dna-selector">
                    <div class="selector-header">
                        <label>Select 80-character DNA Fragment</label>
                        <span id="selectionInfo">Position: 80-160</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="dnaSlider" class="slider" min="0" max="1" value="0">
                        <div class="slider-labels">
                            <span id="startPos">1</span>
                            <span id="endPos">80</span>
                        </div>
                    </div>
                </div>
                
                <div class="selected-dna-section">
                    <label for="selectedDna">Selected DNA Fragment (80 characters)</label>
                    <textarea id="selectedDna" class="selected-dna" maxlength="80"></textarea>
                    <div class="char-count"><span id="charCount">80</span>/80 characters</div>
                    <div class="warning" id="warningText"></div>
                </div>
                
                <div class="button-group">
                    <button class="btn reset-btn" id="resetBtn">Reset Selection</button>
                    <button class="btn save-btn" id="saveBtn">Save Draft</button>
                    <button class="btn run-btn" id="runBtn">Run Test</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const leftPanel = document.getElementById('leftPanel');
            const rightPanel = document.getElementById('rightPanel');
            const continueBtn = document.getElementById('continueBtn');
            const villainOptions = document.querySelectorAll('.villain-option');
            const selectedVillainText = document.getElementById('selectedVillainText');
            const testNameInput = document.getElementById('testName');
            const fullDnaElement = document.getElementById('fullDna');
            const fullDnaLength = document.getElementById('fullDnaLength');
            const dnaSlider = document.getElementById('dnaSlider');
            const startPos = document.getElementById('startPos');
            const endPos = document.getElementById('endPos');
            const selectionInfo = document.getElementById('selectionInfo');
            const selectedDna = document.getElementById('selectedDna');
            const charCount = document.getElementById('charCount');
            const warningText = document.getElementById('warningText');
            const resetBtn = document.getElementById('resetBtn');
            const saveBtn = document.getElementById('saveBtn');
            const runBtn = document.getElementById('runBtn');
            
            // DNA sequences for each virus
            const dnaSequences = {};

            async function loadFasta(name){
                const response = await fetch(`fasta/${name}.fasta`);
                const text = await response.text();
                // Remove header line(s) that begin with '>'
                return text
                    .split("\n")
                    .filter(line => !line.startsWith(">"))
                    .join("").replace(/[^ATCG]/g, '')
                    .trim();
            }

            
            // Selected villain variable
            let selectedVillain = null;
            let currentDnaSequence = '';
            let originalSelectedFragment = '';
            const SELECTION_LENGTH = 80;
            
            // Generate a random DNA sequence
            function generateDnaSequence(length) {
                const bases = ['A', 'T', 'C', 'G'];
                let sequence = '';
                for (let i = 0; i < length; i++) {
                    sequence += bases[Math.floor(Math.random() * bases.length)];
                }
                return sequence;
            }
            
            // Format DNA sequence for display with highlighting
            function formatDnaSequence(sequence, start, end) {
                let formatted = '';
                const chunkSize = 50; // Characters per line
                
                for (let i = 0; i < sequence.length; i += chunkSize) {
                    const chunk = sequence.substring(i, i + chunkSize);
                    let line = '';
                    
                    for (let j = 0; j < chunk.length; j++) {
                        const pos = i + j + 1; // 1-based position
                        if (pos >= start && pos <= end) {
                            line += `<span class="highlight">${chunk[j]}</span>`;
                        } else {
                            line += chunk[j];
                        }
                    }
                    
                    formatted += line + '\n';
                }
                
                return formatted;
            }
            
            // Update DNA display based on slider position
            function updateDnaDisplay() {
                const sliderValue = parseInt(dnaSlider.value);
                const start = sliderValue + 1;
                const end = Math.min(start + SELECTION_LENGTH - 1, currentDnaSequence.length);
                
                // Update position indicators
                startPos.textContent = start;
                endPos.textContent = end;
                selectionInfo.textContent = `Position: ${start}-${end}`;
                
                // Update highlighted DNA
                fullDnaElement.innerHTML = formatDnaSequence(currentDnaSequence, start, end);
                
                // Update selected DNA fragment
                originalSelectedFragment = currentDnaSequence.substring(sliderValue, sliderValue + SELECTION_LENGTH);
                
                // Only update the selected DNA if it hasn't been modified by the user
                //if (selectedDna.value === '' || selectedDna.value === originalSelectedFragment) {
               selectedDna.value = originalSelectedFragment;
                charCount.textContent = originalSelectedFragment.length;
                warningText.textContent = '';

/*
                } else {
                    // Show warning that the fragment has been modified
                    warningText.textContent = 'Note: This fragment has been modified from the original sequence';
                }
                */
                


            }
            
            // Villain selection functionality
            villainOptions.forEach(option => {
                option.addEventListener('click', async function() {
                    // Remove active class from all options
                    villainOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    // Set selected villain
                    selectedVillain = this.getAttribute('data-villain');
                    
                    // Enable continue button
                    continueBtn.disabled = false;
                    
                    // Update test name based on selected villain
                    testNameInput.value = `${selectedVillain} Test`;

                    if (!dnaSequences[selectedVillain]){
                        dnaSequences[selectedVillain]=await loadFasta(selectedVillain);
                    }
                    
                    // Update DNA sequence
                    currentDnaSequence = dnaSequences[selectedVillain];
                    fullDnaLength.textContent = `Length: ${currentDnaSequence.length} characters`;
                    
                    // Update slider max value
                    dnaSlider.max = currentDnaSequence.length - SELECTION_LENGTH;
                    
                    // Reset the selected DNA to the original fragment
                    selectedDna.value = '';
                    warningText.textContent = '';
                    
                    // Update DNA display
                    updateDnaDisplay();
                });
            });
            
            // Continue button functionality
            continueBtn.addEventListener('click', function() {
                if (selectedVillain) {
                    // Hide left panel and show right panel
                    leftPanel.style.display = 'none';
                    rightPanel.style.display = 'flex';
                    
                    // Update selected villain text
                    selectedVillainText.textContent = `Selected Villain: ${selectedVillain}`;
                }
            });
            
            // DNA slider functionality
            dnaSlider.addEventListener('input', updateDnaDisplay);
            
            // Selected DNA fragment character count and validation
            selectedDna.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = count;
                
                // Change color if approaching limit
                if (count >= SELECTION_LENGTH) {
                    charCount.style.color = '#e74c3c';
                } else {
                    charCount.style.color = '#7f8c8d';
                }
                
                // Show warning if modified
                if (this.value !== originalSelectedFragment) {
                    warningText.textContent = 'Note: This fragment has been modified from the original sequence';
                } else {
                    warningText.textContent = '';
                }
            });
            
            // Reset button functionality
            resetBtn.addEventListener('click', function() {
                // Reset to the original selected fragment
                selectedDna.value = originalSelectedFragment;
                charCount.textContent = originalSelectedFragment.length;
                charCount.style.color = '#7f8c8d';
                warningText.textContent = '';
            });
            
            // Save draft button functionality
            saveBtn.addEventListener('click', function() {
                alert('Test draft saved successfully!');
            });
            
            // Run test button functionality
            runBtn.addEventListener('click', function() {
                alert('Test is now running with the selected DNA fragment...');
                // In a real application, this would trigger the test execution
            });


            async function loadAllFastaFiles() {
            dnaSequences.Ebola = await loadFasta("Ebola");
            dnaSequences.Flu   = await loadFasta("Flu");
            dnaSequences.Zika  = await loadFasta("Zika");
            dnaSequences.COVID = await loadFasta("COVID");
            dnaSequences.AIDS  = await loadFasta("AIDS");
        }

        // After DOM is ready, load FASTA files, then auto-select default villain
        loadAllFastaFiles().then(() => {
        // OPTIONAL: you can show a loading spinner while this happens
            document.querySelector('.villain-option[data-villain="Ebola"]').click();
        });



            
            // Initialize with Ebola selected by default
            //document.querySelector('.villain-option[data-villain="Ebola"]').click();
        });
    </script>
</body>
</html>
